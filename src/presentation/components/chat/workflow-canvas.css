/**
 * Modern Workflow Canvas Styles
 * Canvas, nodes, connections, and interactions
 */

@import './design-tokens.css';

/* ========================================
 * Workflow Canvas
 * ======================================== */

.n8n-workflow-canvas {
	position: relative;
	width: 100%;
	height: 100%;
	background-color: var(--n8n-color-canvas-background);
	overflow: hidden;
	cursor: grab;
	user-select: none;
}

.n8n-workflow-canvas:active {
	cursor: grabbing;
}

/* Dotted Grid Background */
.n8n-workflow-canvas::before {
	content: '';
	position: absolute;
	top: 0;
	left: 0;
	right: 0;
	bottom: 0;
	background-image:
		radial-gradient(
			circle,
			var(--n8n-color-canvas-dot) var(--n8n-canvas-dot-size),
			transparent var(--n8n-canvas-dot-size)
		);
	background-size: var(--n8n-canvas-dot-spacing) var(--n8n-canvas-dot-spacing);
	background-position: 0 0;
	pointer-events: none;
	z-index: 0;
}

/* Canvas Container */
.n8n-canvas-container {
	position: relative;
	width: 100%;
	height: 100%;
	transform-origin: 0 0;
	transition: transform var(--n8n-transition-duration-base) var(--n8n-transition-timing);
}

/* ========================================
 * Workflow Nodes
 * ======================================== */

.n8n-node {
	position: absolute;
	width: var(--n8n-node-width);
	min-height: var(--n8n-node-height);
	background: var(--n8n-color-background-light);
	border: 2px solid var(--n8n-color-border-base);
	border-radius: var(--n8n-border-radius-m);
	box-shadow: var(--n8n-shadow-node);
	cursor: pointer;
	transition: all var(--n8n-transition-duration-base) var(--n8n-transition-timing);
	display: flex;
	flex-direction: column;
	align-items: center;
	padding: var(--n8n-node-padding);
	user-select: none;
}

.n8n-node:hover {
	box-shadow: var(--n8n-shadow-node-hover);
	transform: translateY(-2px);
	border-color: var(--n8n-color-primary);
	z-index: 10;
}

.n8n-node.selected {
	border-color: var(--n8n-color-primary);
	box-shadow: var(--n8n-shadow-node-active);
	z-index: 15;
}

.n8n-node.dragging {
	cursor: grabbing;
	opacity: 0.8;
	box-shadow: var(--n8n-shadow-xl);
	z-index: 20;
}

/* Node States */
.n8n-node.running {
	border-color: var(--n8n-node-color-running);
	animation: pulse 1.5s ease-in-out infinite;
}

.n8n-node.success {
	border-color: var(--n8n-node-color-success);
}

.n8n-node.error {
	border-color: var(--n8n-node-color-error);
	background-color: hsla(6, 78%, 57%, 0.05);
}

.n8n-node.disabled {
	opacity: 0.5;
	cursor: not-allowed;
	filter: grayscale(0.5);
}

@keyframes pulse {
	0%, 100% {
		box-shadow: var(--n8n-shadow-node);
	}
	50% {
		box-shadow: 0 0 20px var(--n8n-node-color-running);
	}
}

/* ========================================
 * Node Icon
 * ======================================== */

.n8n-node-icon {
	width: var(--n8n-node-icon-size);
	height: var(--n8n-node-icon-size);
	border-radius: var(--n8n-border-radius-m);
	display: flex;
	align-items: center;
	justify-content: center;
	font-size: var(--n8n-font-size-2xl);
	margin-bottom: var(--n8n-spacing-2xs);
	background: linear-gradient(135deg, var(--n8n-color-background-base) 0%, var(--n8n-color-background-light) 100%);
	border: 1px solid var(--n8n-color-border-light);
	transition: transform var(--n8n-transition-duration-fast);
}

.n8n-node:hover .n8n-node-icon {
	transform: scale(1.05);
}

/* Node Type Specific Icons */
.n8n-node.type-trigger .n8n-node-icon {
	background: linear-gradient(135deg, var(--n8n-node-color-trigger), hsl(261, 60%, 66%));
	color: white;
}

.n8n-node.type-action .n8n-node-icon {
	background: linear-gradient(135deg, var(--n8n-node-color-action), hsl(207, 90%, 64%));
	color: white;
}

.n8n-node.type-logic .n8n-node-icon {
	background: linear-gradient(135deg, var(--n8n-node-color-logic), hsl(38, 100%, 65%));
	color: white;
}

.n8n-node.type-data .n8n-node-icon {
	background: linear-gradient(135deg, var(--n8n-node-color-data), hsl(161, 64%, 52%));
	color: white;
}

.n8n-node.type-ai .n8n-node-icon {
	background: linear-gradient(135deg, var(--n8n-node-color-ai), hsl(291, 64%, 72%));
	color: white;
}

/* ========================================
 * Node Label
 * ======================================== */

.n8n-node-label {
	font-size: var(--n8n-font-size-xs);
	font-weight: var(--n8n-font-weight-medium);
	color: var(--n8n-color-foreground-dark);
	text-align: center;
	max-width: 100%;
	overflow: hidden;
	text-overflow: ellipsis;
	white-space: nowrap;
	line-height: var(--n8n-line-height-compact);
}

.n8n-node-subtitle {
	font-size: var(--n8n-font-size-3xs);
	color: var(--n8n-color-foreground-light);
	text-align: center;
	margin-top: 2px;
	max-width: 100%;
	overflow: hidden;
	text-overflow: ellipsis;
	white-space: nowrap;
}

/* ========================================
 * Node Ports (Connection Points)
 * ======================================== */

.n8n-node-ports {
	position: absolute;
	width: 100%;
	height: 100%;
	top: 0;
	left: 0;
	pointer-events: none;
}

.n8n-node-port {
	position: absolute;
	width: 12px;
	height: 12px;
	background: var(--n8n-color-background-light);
	border: 2px solid var(--n8n-color-border-strong);
	border-radius: var(--n8n-border-radius-full);
	cursor: crosshair;
	pointer-events: all;
	transition: all var(--n8n-transition-duration-fast);
	z-index: 5;
}

.n8n-node-port:hover {
	transform: scale(1.3);
	border-color: var(--n8n-color-primary);
	box-shadow: 0 0 8px var(--n8n-color-primary);
}

.n8n-node-port.input {
	left: -6px;
	top: 50%;
	transform: translateY(-50%);
}

.n8n-node-port.output {
	right: -6px;
	top: 50%;
	transform: translateY(-50%);
}

.n8n-node-port.active {
	border-color: var(--n8n-color-primary);
	background: var(--n8n-color-primary);
	box-shadow: 0 0 12px var(--n8n-color-primary);
}

/* ========================================
 * Node Badges/Indicators
 * ======================================== */

.n8n-node-badge {
	position: absolute;
	top: -6px;
	right: -6px;
	min-width: 18px;
	height: 18px;
	padding: 0 4px;
	background: var(--n8n-color-primary);
	color: white;
	border-radius: var(--n8n-border-radius-full);
	font-size: var(--n8n-font-size-3xs);
	font-weight: var(--n8n-font-weight-semibold);
	display: flex;
	align-items: center;
	justify-content: center;
	box-shadow: var(--n8n-shadow-s);
	z-index: 10;
}

.n8n-node-badge.error {
	background: var(--n8n-color-danger);
}

.n8n-node-badge.warning {
	background: var(--n8n-color-warning);
}

.n8n-node-badge.success {
	background: var(--n8n-color-success);
}

/* ========================================
 * Connections (Lines between nodes)
 * ======================================== */

.n8n-connection {
	position: absolute;
	pointer-events: stroke;
	cursor: pointer;
	z-index: 1;
}

.n8n-connection-path {
	fill: none;
	stroke: var(--n8n-connection-main);
	stroke-width: var(--n8n-connection-stroke);
	transition: all var(--n8n-transition-duration-base);
}

.n8n-connection:hover .n8n-connection-path {
	stroke: var(--n8n-connection-hover);
	stroke-width: var(--n8n-connection-stroke-active);
}

.n8n-connection.active .n8n-connection-path {
	stroke: var(--n8n-connection-main-active);
	stroke-width: var(--n8n-connection-stroke-active);
	filter: drop-shadow(0 0 4px var(--n8n-connection-main-active));
}

.n8n-connection.error .n8n-connection-path {
	stroke: var(--n8n-connection-error);
	stroke-dasharray: 4, 4;
}

.n8n-connection.ai .n8n-connection-path {
	stroke: var(--n8n-connection-ai);
	stroke-dasharray: 8, 4;
}

/* Connection Animation */
.n8n-connection.animating .n8n-connection-path {
	stroke-dasharray: 8, 4;
	animation: connection-flow 1s linear infinite;
}

@keyframes connection-flow {
	to {
		stroke-dashoffset: -12;
	}
}

/* Connection Endpoints */
.n8n-connection-endpoint {
	fill: var(--n8n-connection-main);
	transition: all var(--n8n-transition-duration-base);
}

.n8n-connection:hover .n8n-connection-endpoint {
	fill: var(--n8n-connection-hover);
	r: 5;
}

/* ========================================
 * Node Selection Box
 * ======================================== */

.n8n-selection-box {
	position: absolute;
	border: 2px dashed var(--n8n-color-primary);
	background: hsla(348, 100%, 67%, 0.1);
	pointer-events: none;
	z-index: 100;
}

/* ========================================
 * Minimap
 * ======================================== */

.n8n-minimap {
	position: absolute;
	bottom: var(--n8n-spacing-m);
	right: var(--n8n-spacing-m);
	width: 200px;
	height: 150px;
	background: var(--n8n-color-background-light);
	border: 1px solid var(--n8n-color-border-base);
	border-radius: var(--n8n-border-radius-m);
	box-shadow: var(--n8n-shadow-m);
	overflow: hidden;
	z-index: 50;
}

.n8n-minimap-viewport {
	position: absolute;
	border: 2px solid var(--n8n-color-primary);
	background: hsla(348, 100%, 67%, 0.1);
	cursor: move;
}

/* ========================================
 * Zoom Controls
 * ======================================== */

.n8n-zoom-controls {
	position: absolute;
	bottom: var(--n8n-spacing-m);
	left: var(--n8n-spacing-m);
	display: flex;
	flex-direction: column;
	gap: var(--n8n-spacing-2xs);
	z-index: 50;
}

.n8n-zoom-btn {
	width: 36px;
	height: 36px;
	background: var(--n8n-color-background-light);
	border: 1px solid var(--n8n-color-border-base);
	border-radius: var(--n8n-border-radius-base);
	display: flex;
	align-items: center;
	justify-content: center;
	cursor: pointer;
	transition: all var(--n8n-transition-duration-fast);
	box-shadow: var(--n8n-shadow-s);
	color: var(--n8n-color-foreground-dark);
	font-size: var(--n8n-font-size-l);
	font-weight: var(--n8n-font-weight-bold);
}

.n8n-zoom-btn:hover {
	background: var(--n8n-color-primary);
	color: white;
	border-color: var(--n8n-color-primary);
	box-shadow: var(--n8n-shadow-base);
}

.n8n-zoom-level {
	padding: var(--n8n-spacing-3xs) var(--n8n-spacing-2xs);
	background: var(--n8n-color-background-light);
	border: 1px solid var(--n8n-color-border-base);
	border-radius: var(--n8n-border-radius-base);
	text-align: center;
	font-size: var(--n8n-font-size-xs);
	font-weight: var(--n8n-font-weight-medium);
	color: var(--n8n-color-foreground-dark);
	box-shadow: var(--n8n-shadow-s);
}

/* ========================================
 * Context Menu
 * ======================================== */

.n8n-context-menu {
	position: absolute;
	background: var(--n8n-color-background-light);
	border: 1px solid var(--n8n-color-border-base);
	border-radius: var(--n8n-border-radius-m);
	box-shadow: var(--n8n-shadow-l);
	padding: var(--n8n-spacing-3xs);
	min-width: 180px;
	z-index: var(--n8n-z-index-popover);
}

.n8n-context-menu-item {
	padding: var(--n8n-spacing-2xs) var(--n8n-spacing-xs);
	border-radius: var(--n8n-border-radius-s);
	cursor: pointer;
	transition: all var(--n8n-transition-duration-fast);
	display: flex;
	align-items: center;
	gap: var(--n8n-spacing-2xs);
	font-size: var(--n8n-font-size-s);
	color: var(--n8n-color-foreground-dark);
}

.n8n-context-menu-item:hover {
	background: var(--n8n-color-background-base);
}

.n8n-context-menu-item.danger:hover {
	background: var(--n8n-color-danger);
	color: white;
}

.n8n-context-menu-divider {
	height: 1px;
	background: var(--n8n-color-border-light);
	margin: var(--n8n-spacing-3xs) 0;
}

/* ========================================
 * Node Add Button (Plus between nodes)
 * ======================================== */

.n8n-add-node-btn {
	position: absolute;
	width: 32px;
	height: 32px;
	background: var(--n8n-color-primary);
	color: white;
	border: 2px solid var(--n8n-color-background-light);
	border-radius: var(--n8n-border-radius-full);
	display: flex;
	align-items: center;
	justify-content: center;
	cursor: pointer;
	font-size: var(--n8n-font-size-xl);
	font-weight: var(--n8n-font-weight-bold);
	box-shadow: var(--n8n-shadow-base);
	transition: all var(--n8n-transition-duration-fast);
	z-index: 10;
	opacity: 0;
}

.n8n-connection:hover .n8n-add-node-btn {
	opacity: 1;
}

.n8n-add-node-btn:hover {
	transform: scale(1.1);
	box-shadow: var(--n8n-shadow-m);
}

/* ========================================
 * Responsive Adjustments
 * ======================================== */

@media (max-width: 768px) {
	.n8n-minimap {
		width: 150px;
		height: 100px;
	}

	.n8n-zoom-controls {
		bottom: var(--n8n-spacing-s);
		left: var(--n8n-spacing-s);
	}
}
